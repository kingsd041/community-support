--- rancher-save-images.sh	2021-05-06 13:45:33.000000000 +0800
+++ rancher-save-images-ksd.sh	2021-05-07 22:10:17.000000000 +0800
@@ -3,9 +3,10 @@
 images="rancher-images.tar.gz"
 
 usage () {
-    echo "USAGE: $0 [--image-list rancher-images.txt] [--images rancher-images.tar.gz]"
+    echo "USAGE: $0 [--image-list rancher-images.txt] [--images rancher-images.tar.gz] [--from-aliyun true]"
     echo "  [-l|--image-list path] text file with list of images; one image per line."
     echo "  [-i|--images path] tar.gz generated by docker save."
+    echo "  [--from-aliyun true|false] get an image from aliyun"
     echo "  [-h|--help] Usage message"
 }
 
@@ -23,6 +24,11 @@
         shift # past argument
         shift # past value
         ;;
+        --from-aliyun)
+        from_aliyun="$2"
+        shift # past argument
+        shift # past value
+        ;;
         -h|--help)
         help="true"
         shift
@@ -42,8 +48,20 @@
 pulled=""
 while IFS= read -r i; do
     [ -z "${i}" ] && continue
+    if [[ $from_aliyun == "true" ]]; then
+        if [[ $i == "busybox" ]] || [[ $i == "registry:2" ]]; then
+            i="registry.cn-hangzhou.aliyuncs.com/rancher/$i"
+        else
+            i="registry.cn-hangzhou.aliyuncs.com/$i"
+        fi
+    fi
     if docker pull "${i}" > /dev/null 2>&1; then
         echo "Image pull success: ${i}"
+        if [[ $from_aliyun == "true" ]]; then
+            docker_i=$(echo ${i#*/})
+            docker tag ${i} ${docker_i}
+            i=${docker_i}
+        fi
         pulled="${pulled} ${i}"
     else
         if docker inspect "${i}" > /dev/null 2>&1; then
